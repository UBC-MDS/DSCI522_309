---
title: "Exploratory Data Analysis"
output: 
  github_document:
    pandoc_args: --webtex
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table, quietly = TRUE)
library(tidyverse, quietly = TRUE)
library(plotly, quietly = TRUE)
library(cowplot, quietly = TRUE)

```


## Summary
- Each row represent a session by a user.  
- Each user has only 1 session in the dataset.  
- The data is for 1-year period.  
- ~15% sessions resulted in a purchase.  


## Description of the variables, [data source](https://archive.ics.uci.edu/ml/datasets/Online+Shoppers+Purchasing+Intention+Dataset)

| S No. | Variable | Description |
| ----------- | ----------- | ----------- |
| 1 | `Administrative` | Number of Distinct administrative pages |
| 2 | `Informational` | Number of Distinct Informational pages |
| 3 | `ProductRelated` | Number of Distinct Product Related pages |
| 4 | `Administrative_Duration` | Time(in seconds) spent on Administrative pages |
| 5 | `Informational_Duration` | Time(in seconds) spent on Informational pages |
| 6 | `ProductRelated_Duration` | Time(in seconds) spent on Product Related pages |
| 7 | `BounceRates` | Average bounce rate of all web-pages visited by user. For a web-page its the percentage of people who visit the website from that webpage and left without raising any other request |
| 8 | `ExitRates` | Average exit rate of all web-pages visited by user: For a web-page its the percentage of people who exited the website from that webpage |
| 9 | `PageValues` | Average page value of all web-pages visited by user: For a web-page its the average dollar-value of that page which the user visited before completing the transaction |
| 10 | `SpecialDay` | The closeness of site visitng time to a special day (higher chances of a session resulting in a transaction) |
| 11 | `OperatingSystems` | Operating system used by the user |
| 12 | `Month` | Month of Year |
| 13 | `Browser` | Browser used by the user |
| 14 | `Region` | Geographic region |
| 15 | `TrafficType` | Type of Channel user by the user to arrive at the website |
| 16 | `VisitorType` | Type of the visitor |
| 17 | `Weekend` | Weekend indicator |
| 18 | `Revenue` | Revenue transaction indicator |



```{r loading the data}

X_train <- suppressMessages(read_csv("../data/X_train.csv"))
y_train <- suppressMessages(read_csv("../data/y_train.csv"))

mydata <- cbind(X_train, y_train)
setDT(mydata)

num_vars_1 <- c("Administrative", "Informational", "ProductRelated")
num_vars_2 <- c("Administrative_Duration", "Informational_Duration", "ProductRelated_Duration", 
                "BounceRates", "ExitRates", 
                "PageValues", "ProductRelated")
target <- "Revenue"
cat_vars <- setdiff(names(mydata), c(num_vars_1, num_vars_2, target))

x <- sapply(mydata, function(x) sum(is.na(x)))
col_na <- names(x[x>0])
print(paste("Variables with NA values:", col_na))

ggplot(mydata, aes(Administrative)) + geom_histogram(binwidth = 1)
ggplot(mydata, aes(Informational)) + geom_histogram(binwidth = 1)
ggplot(mydata, aes(ProductRelated)) + geom_histogram(binwidth = 1)

```

## Summary of Numeric Variables
```{r numerical_variable_exploration}

quantile_dist <- sapply(num_vars_2, FUN=function(x) {
  print(paste("Mean of", x, "is", round(mydata[, mean(get(x))], digits=3), 
              "and standard deviation is", round(mydata[, sd(get(x))], digits=3)))
  mydata[, round(quantile(get(x), probs=seq(0,1,0.05)), digits=3)]
})
print(quantile_dist)

```

## Percentage of rows for categories of categorical variables
```{r categorical_variable_exploration}
# Percentage of rows for categories of categorical variables
sapply(c(cat_vars, target), FUN=function(x) {
  round(mydata[, table(get(x))]/nrow(mydata), digits=3)*100
})

```



## Target vs Other Variables
```{r Target vs Other Variables}


chart1 <- ggplot(mydata, aes(Revenue, Administrative_Duration, fill=Revenue)) + geom_boxplot()
chart2 <- ggplot(mydata, aes(Revenue, Informational_Duration, fill=Revenue)) + geom_boxplot()
chart3 <- ggplot(mydata, aes(Revenue, ProductRelated_Duration, fill=Revenue)) + geom_boxplot()
chart4 <- ggplot(mydata, aes(Revenue, BounceRates, fill=Revenue)) + geom_boxplot()
chart5 <- ggplot(mydata, aes(Revenue, ExitRates, fill=Revenue)) + geom_boxplot()
chart6 <- ggplot(mydata, aes(Revenue, PageValues, fill=Revenue)) + geom_boxplot()
chart7 <- ggplot(mydata, aes(Revenue, ProductRelated, fill=Revenue)) + geom_boxplot()

plot_grid(chart1, chart2, chart3, chart4, chart5, chart6, chart7, nrow=4)


chart_a <- ggplot(mydata, aes(SpecialDay, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_b <- ggplot(mydata, aes(Month, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_c <- ggplot(mydata, aes(OperatingSystems, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_d <- ggplot(mydata, aes(Browser, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_e <- ggplot(mydata, aes(Region, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_f <- ggplot(mydata, aes(TrafficType, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_g <- ggplot(mydata, aes(VisitorType, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")
chart_h <- ggplot(mydata, aes(Weekend, fill=Revenue)) + geom_bar(stat = "count", position = "dodge")

options(repr.plot.width = 20, repr.plot.height = 8)
plot_grid(chart_a, chart_b, chart_c, chart_d, chart_e, chart_f, chart_g, chart_h, nrow=4)

```














